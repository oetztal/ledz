<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>About - ledz</title>
    <link rel="stylesheet" href="/common.css">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Device Information</h1>
        </div>
        <div class="nav">
            <a href="/">&larr; Back to Control</a>
        </div>
        <div class="content">
            <div class="section">
                <h2>Device</h2>
                <div id="deviceInfo"></div>
            </div>
            <div class="section">
                <h2>Hardware</h2>
                <div id="hardwareInfo"></div>
            </div>
            <div class="section">
                <h2>Memory</h2>
                <div id="memoryInfo"></div>
            </div>
            <div class="section">
                <h2>Network</h2>
                <div id="networkInfo"></div>
            </div>
            <button class="btn btn-primary" onclick="loadInfo()">Refresh</button>
        </div>
    </div>
    <script>
        function formatBytes(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        function formatUptime(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            if (days > 0) return days + 'd ' + (hours % 24) + 'h';
            if (hours > 0) return hours + 'h ' + (minutes % 60) + 'm';
            return minutes + 'm ' + (seconds % 60) + 's';
        }
        function createRow(label, value) {
            return `<div class="info-row"><span class="info-label">${label}</span><span class="info-value">${value}</span></div>`;
        }
        async function loadInfo() {
            try {
                const response = await fetch('/api/about');
                const data = await response.json();

                document.getElementById('deviceInfo').innerHTML =
                    createRow('Device ID', data.device_id) +
                    createRow('Uptime', formatUptime(data.uptime_ms));

                document.getElementById('hardwareInfo').innerHTML =
                    createRow('Chip Model', data.chip_model) +
                    createRow('Chip Revision', data.chip_revision) +
                    createRow('CPU Cores', data.chip_cores) +
                    createRow('CPU Frequency', data.cpu_freq_mhz + ' MHz') +
                    (data.cpu_temp ? createRow('CPU Temp', data.cpu_temp.toFixed(1) + ' Â°C') : '');

                const heapUsage = ((data.heap_size - data.free_heap) / data.heap_size * 100).toFixed(1);
                document.getElementById('memoryInfo').innerHTML =
                    createRow('Free Heap', formatBytes(data.free_heap)) +
                    createRow('Total Heap', formatBytes(data.heap_size)) +
                    createRow('Heap Usage', heapUsage + '%') +
                    createRow('Min Free Heap', formatBytes(data.min_free_heap)) +
                    createRow('Flash Size', formatBytes(data.flash_size));

                let networkHTML = '';
                if (data.wifi_ssid) {
                    networkHTML =
                        createRow('Status', 'Connected') +
                        createRow('SSID', data.wifi_ssid) +
                        createRow('Signal', data.wifi_rssi + ' dBm') +
                        createRow('IP Address', data.ip_address) +
                        createRow('MAC Address', data.mac_address);
                } else if (data.ap_ssid) {
                    networkHTML =
                        createRow('Status', 'Access Point') +
                        createRow('SSID', data.ap_ssid) +
                        createRow('IP Address', data.ap_ip) +
                        createRow('Clients', data.ap_clients);
                } else {
                    networkHTML = createRow('Status', 'Disconnected');
                }
                document.getElementById('networkInfo').innerHTML = networkHTML;
            } catch (error) {
                console.error('Failed to load device info:', error);
            }
        }
        loadInfo();
    </script>
</body>
</html>
